{% extends "network/layout.html" %}

{% block body %}

{%  block all_posts %}

{% endblock %}


{% for post in posts %}
<div class="post">
    <h6 class="author"> 
        <a href="{% url 'profile' post.author %}"><strong class = "post_author">{{ post.author}}</strong></a>
    </h6>
    <h6 class ="post_information">{{post.information}}</h6>
    <h6>{{post.date}}</h6>
    {% if post.author == user %}
        <input class="btn btn-primary" type="submit" value="Edit">
    {% endif %}

    
    <span data-post-id="{{post.id}}" class="heart" onclick="likes(this)">
        {% if not user in post.likes.all %}
            🖤
        {% else %}
            ❤️
        {% endif %}
        </span>
    <span class = "likes" id="likes-{{post.id}}">{{post.likes.all|length}}</span>

</div>
{%endfor%}

{% block pagination %}
{% endblock %}


{% csrf_token %}
<script>
    function likes(heart) {
        const csfr_token = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
        const liked_post_id = heart.getAttribute('data-post-id');
        const data = { post_id: liked_post_id };
        fetch("{% url 'like' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csfr_token
            },
            body: JSON.stringify(data),
        })
            .then(response => response.json())
            .then(result => {
                document.querySelector(`#likes-${liked_post_id}`).innerHTML = result.count_likes;
            });

        if (heart.innerHTML === '❤️') {
            heart.innerHTML = '🖤'; // změníme na černé srdíčko
        } else {
            heart.innerHTML = '❤️'; // změníme na červené srdíčko
        }
    }
</script>

{% endblock %}
